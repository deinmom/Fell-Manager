<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="de"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="UTF-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Fellmanager&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>body { max-width: 700px; margin: 2rem auto; font-family: sans-serif; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card { border: 1px solid #ccc; border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.header { font-size: 24px; font-weight: bold; text-align: center; margin-bottom: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.title { font-size: 18px; font-weight: bold; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.wiki<span class="Apple-converted-space">  </span>{ font-size: 14px; color: #555; margin: .5rem 0; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.controls { display: flex; justify-content: space-between; align-items: center; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.controls button { border: none; color: white; padding: .5rem 1rem; border-radius: 5px; cursor: pointer; font-size: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.minus { background: #e53e3e; margin-right: .5rem; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>.plus<span class="Apple-converted-space">  </span>{ background: #38a169; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>/* Admin-Menü */</p>
<p class="p1"><span class="Apple-converted-space">    </span>#adminMenu { margin-top: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>#adminMenu button { margin-right: .5rem; padding: .5rem 1rem; font-size: 1rem; }</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Supabase-JS via CDN --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"&gt;&lt;/script&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="header"&gt;Fellmanager&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Container für die Kartenliste --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="container"&gt;Lade Daten...&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Admin-Menü (nur im Admin-Modus sichtbar) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div id="adminMenu" style="display:none;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="btnExportCSV"&gt;Export als CSV&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="file" id="fileInput" accept=".csv" style="display:none;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;button id="btnImportCSV"&gt;Import CSV&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// 1) Supabase-Zugangsdaten</p>
<p class="p1"><span class="Apple-converted-space">    </span>const SUPABASE_URL <span class="Apple-converted-space">    </span>= "https://owrfgjypnemsxonmbrpj.supabase.co";</p>
<p class="p1"><span class="Apple-converted-space">    </span>const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93cmZnanlwbmVtc3hvbm1icnBqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczMTUyOTgsImV4cCI6MjA2Mjg5MTI5OH0.X1PymyDZqNe_Plmao8U6gdqFKP70VrFtuZTesgyZMwg"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpZVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93cmZnanlwbmVtc3hvbmJyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczMTUyOTgsImV4cCI6MjA2Mjg5MTI5OH0.X1PymyDZqNe_Plmao8U6gdqFKP70VrFtuZTesgyZMwg";</p>
<p class="p1"><span class="Apple-converted-space">    </span>const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>const container = document.getElementById("container");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const adminMenu = document.getElementById("adminMenu");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const btnExportCSV = document.getElementById("btnExportCSV");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const btnImportCSV = document.getElementById("btnImportCSV");</p>
<p class="p1"><span class="Apple-converted-space">    </span>const fileInput = document.getElementById("fileInput");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let allData = [];</p>
<p class="p1"><span class="Apple-converted-space">    </span>let isAdmin = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 2) Daten laden, sortieren und anzeigen</p>
<p class="p1"><span class="Apple-converted-space">    </span>async function loadFelle() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const { data, error } = await supabase</p>
<p class="p1"><span class="Apple-converted-space">        </span>.from("felle")</p>
<p class="p1"><span class="Apple-converted-space">        </span>.select("*");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.error(error);</p>
<p class="p1"><span class="Apple-converted-space">        </span>container.innerHTML = "&lt;p style='color:red'&gt;Fehler beim Laden der Daten.&lt;/p&gt;";</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Sortierung: Hersteller → Serie → numerisch nach Größe</p>
<p class="p1"><span class="Apple-converted-space">      </span>allData = data.sort((a, b) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>// 1) Hersteller alphabetisch</p>
<p class="p1"><span class="Apple-converted-space">        </span>const hCmp = a.hersteller.localeCompare(b.hersteller);</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (hCmp !== 0) return hCmp;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// 2) Serie alphabetisch</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sCmp = (a.serie || "").localeCompare(b.serie || "");</p>
<p class="p1"><span class="Apple-converted-space">        </span>if (sCmp !== 0) return sCmp;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// 3) Größe numerisch (z.B. "14")</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sizeA = parseInt((a.groesse || "").replace(/[^0-9]/g, ""), 10) || 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sizeB = parseInt((b.groesse || "").replace(/[^0-9]/g, ""), 10) || 0;</p>
<p class="p1"><span class="Apple-converted-space">        </span>return sizeA - sizeB;</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>renderFelle(allData);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 3) Karten anzeigen</p>
<p class="p1"><span class="Apple-converted-space">    </span>function renderFelle(dataArray) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>container.innerHTML = "";</p>
<p class="p1"><span class="Apple-converted-space">      </span>dataArray.forEach(fell =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const card = document.createElement("div");</p>
<p class="p1"><span class="Apple-converted-space">        </span>card.className = "card";</p>
<p class="p1"><span class="Apple-converted-space">        </span>card.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="title"&gt;${fell.id} – ${fell.hersteller} ${fell.serie} ${fell.groesse}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="wiki"&gt;${fell.wiki}&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="controls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;Bestand: &lt;strong&gt;${fell.bestand}&lt;/strong&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button class="minus"&gt;-1&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;button class="plus"&gt;+1&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Button-Handler</p>
<p class="p1"><span class="Apple-converted-space">        </span>card.querySelector(".minus").onclick = () =&gt; updateBestand(fell.id, -1);</p>
<p class="p1"><span class="Apple-converted-space">        </span>card.querySelector(".plus").onclick<span class="Apple-converted-space">  </span>= () =&gt; updateBestand(fell.id, +1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>container.append(card);</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 4) Bestand aktualisieren</p>
<p class="p1"><span class="Apple-converted-space">    </span>async function updateBestand(id, delta) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const { error } = await supabase</p>
<p class="p1"><span class="Apple-converted-space">        </span>.from("felle")</p>
<p class="p1"><span class="Apple-converted-space">        </span>.update({ bestand: supabase.raw("bestand + ?", [delta]) })</p>
<p class="p1"><span class="Apple-converted-space">        </span>.eq("id", id);</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>console.error("Update-Fehler:", error);</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>await loadFelle();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 5) Export als CSV (alphabetisch nach id, plus Datum+Uhrzeit im Dateinamen)</p>
<p class="p1"><span class="Apple-converted-space">    </span>function exportAsCSV() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!allData.length) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Kopie und Sortierung nach id (alphabetisch)</p>
<p class="p1"><span class="Apple-converted-space">      </span>const rows = [...allData].sort((a, b) =&gt; a.id.localeCompare(b.id));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// CSV-Header</p>
<p class="p1"><span class="Apple-converted-space">      </span>const header = ["id", "hersteller", "serie", "groesse", "bestand", "warnschwelle", "wiki", "typ_a", "typ_b"];</p>
<p class="p1"><span class="Apple-converted-space">      </span>const csvRows = [header.join(",")];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Datenzeilen bauen</p>
<p class="p1"><span class="Apple-converted-space">      </span>rows.forEach(f =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const values = [</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.id,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.hersteller,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.serie,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.groesse,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.bestand,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.warnschwelle,</p>
<p class="p1"><span class="Apple-converted-space">          </span>`"${f.wiki.replace(/"/g, '""')}"`,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.typ_a,</p>
<p class="p1"><span class="Apple-converted-space">          </span>f.typ_b</p>
<p class="p1"><span class="Apple-converted-space">        </span>];</p>
<p class="p1"><span class="Apple-converted-space">        </span>csvRows.push(values.join(","));</p>
<p class="p1"><span class="Apple-converted-space">      </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const csvString = csvRows.join("\n");</p>
<p class="p1"><span class="Apple-converted-space">      </span>const blob = new Blob([csvString], { type: "text/csv;charset=utf-8;" });</p>
<p class="p1"><span class="Apple-converted-space">      </span>const url = URL.createObjectURL(blob);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Aktuelles Datum und Uhrzeit</p>
<p class="p1"><span class="Apple-converted-space">      </span>const now = new Date();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const dd = String(now.getDate()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const mm = String(now.getMonth() + 1).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const yy = now.getFullYear();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const hh = String(now.getHours()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const min = String(now.getMinutes()).padStart(2, '0');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const filename = `Fellbestand_${dd}.${mm}.${yy}_${hh}-${min}.csv`;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// Download-Link erzeugen</p>
<p class="p1"><span class="Apple-converted-space">      </span>const link = document.createElement("a");</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.setAttribute("href", url);</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.setAttribute("download", filename);</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.appendChild(link);</p>
<p class="p1"><span class="Apple-converted-space">      </span>link.click();</p>
<p class="p1"><span class="Apple-converted-space">      </span>document.body.removeChild(link);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 6) CSV-Import</p>
<p class="p1"><span class="Apple-converted-space">    </span>function handleFileImport(event) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const file = event.target.files[0];</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!file) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>const reader = new FileReader();</p>
<p class="p1"><span class="Apple-converted-space">      </span>reader.onload = async function(e) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const text = e.target.result;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lines = text.split(/\r?\n/).filter(l =&gt; l.trim());</p>
<p class="p1"><span class="Apple-converted-space">        </span>const header = lines.shift().split(",");</p>
<p class="p1"><span class="Apple-converted-space">        </span>const idIdx = header.indexOf("id");</p>
<p class="p1"><span class="Apple-converted-space">        </span>const bestandIdx = header.indexOf("bestand");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>for (let line of lines) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>const cols = line.split(",");</p>
<p class="p1"><span class="Apple-converted-space">          </span>const id = cols[idIdx];</p>
<p class="p1"><span class="Apple-converted-space">          </span>const bestand = parseInt(cols[bestandIdx], 10);</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (!id) continue;</p>
<p class="p1"><span class="Apple-converted-space">          </span>await supabase</p>
<p class="p1"><span class="Apple-converted-space">            </span>.from("felle")</p>
<p class="p1"><span class="Apple-converted-space">            </span>.update({ bestand })</p>
<p class="p1"><span class="Apple-converted-space">            </span>.eq("id", id);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>await loadFelle();</p>
<p class="p1"><span class="Apple-converted-space">      </span>};</p>
<p class="p1"><span class="Apple-converted-space">      </span>reader.readAsText(file);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// 7) Admin-Modus umschalten</p>
<p class="p1"><span class="Apple-converted-space">    </span>function toggleAdmin() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>isAdmin = !isAdmin;</p>
<p class="p1"><span class="Apple-converted-space">      </span>adminMenu.style.display = isAdmin ? "block" : "none";</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Eventlistener</p>
<p class="p1"><span class="Apple-converted-space">    </span>btnExportCSV.onclick = exportAsCSV;</p>
<p class="p1"><span class="Apple-converted-space">    </span>btnImportCSV.onclick = () =&gt; fileInput.click();</p>
<p class="p1"><span class="Apple-converted-space">    </span>fileInput.onchange = handleFileImport;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Initial aufrufen</p>
<p class="p1"><span class="Apple-converted-space">    </span>loadFelle();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// Admin-Modus per "Ctrl+M" umschalten</p>
<p class="p1"><span class="Apple-converted-space">    </span>document.addEventListener("keydown", e =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (e.ctrlKey &amp;&amp; e.key === "m") {</p>
<p class="p1"><span class="Apple-converted-space">        </span>toggleAdmin();</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
